/* Roguelike CRT Theme - DungeonMode Font with CRT Effect */

/* CRT Color Variables */
:root {
    --crt-red: rgb(218, 49, 49);
    --crt-green: rgb(112, 159, 115);
    --crt-blue: rgb(40, 129, 206);
    --crt-bg: rgb(25, 25, 30);
    --crt-text: rgba(255, 255, 255, 0.85);
    --crt-text-dim: rgba(255, 255, 255, 0.6);
    --crt-amber: rgb(255, 176, 0);
    --crt-cyan: rgb(0, 255, 255);
    --crt-magenta: rgb(255, 0, 255);
}

/* DungeonMode Font */
@font-face {
    font-family: "DungeonMode";
    src: url("/fonts/dungeonmode/font/dungeon-mode.ttf") format("truetype");
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: "DungeonModeInverted";
    src: url("/fonts/dungeonmode/font/dungeon-mode-inverted.ttf")
        format("truetype");
    font-weight: normal;
    font-style: normal;
}

/* Base CRT styles when .roguelike class is on body */
body.roguelike {
    font-family: "Monogram", "DungeonMode", "Courier New", monospace;
    background-color: var(--crt-bg);
    color: var(--crt-text);
    font-size: 18px;
    line-height: 1.3;
    image-rendering: pixelated;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    position: relative;
    overflow: hidden;
    --crt-frame-size: 16px;
    --crt-soft-blur: 0.7px;
}

/* CRT frame around the panel */
body.roguelike [data-crt-frame="true"] {
    position: relative;
    isolation: isolate;
    overflow: hidden;
    border-radius: var(--crt-frame-size);
    background-color: var(--crt-bg);
}

/* CRT frame to mask barrel bleed */
body.roguelike [data-crt-frame="true"]::before {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 30;
    border: var(--crt-frame-size) solid rgba(10, 10, 12, 0.95);
    border-radius: var(--crt-frame-size);
    box-shadow:
        inset 0 0 55px rgba(0, 0, 0, 0.9),
        inset 0 0 120px rgba(0, 0, 0, 0.6),
        0 0 0 2px rgba(112, 159, 115, 0.4);
}

/* CRT inner surface */
body.roguelike [data-crt-barrel="true"] {
    position: relative;
    isolation: isolate;
    overflow: hidden;
    border-radius: calc(var(--crt-frame-size) - 4px);
}

body.roguelike [data-crt-barrel="true"]::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 19;
    border-radius: inherit;
    background:
        repeating-linear-gradient(
            0deg,
            rgba(0, 0, 0, 0.28) 0px,
            rgba(0, 0, 0, 0.28) 1px,
            rgba(0, 0, 0, 0) 1px,
            rgba(0, 0, 0, 0) 3px
        ),
        radial-gradient(
            ellipse at center,
            rgba(255, 255, 255, 0.02) 0%,
            rgba(0, 0, 0, 0.04) 65%,
            rgba(0, 0, 0, 0.28) 100%
        );
}

/* Override Tailwind text sizes for better readability */
body.roguelike .text-xs {
    font-size: 1.5rem;
    line-height: 0.7;
}

body.roguelike .text-sm {
    font-size: 1.8rem;
    line-height: 1;
}

/* Log uses Courier New for a classic terminal feel */
body.roguelike [data-component="log"],
body.roguelike .log-entry,
body.roguelike .log-content {
    font-family: "Courier New", "Courier", monospace;
    font-size: 16px; /* slightly larger for readability */
    line-height: 1.6;
    font-weight: 600;
}

/* Root container - NO global CRT effect */
body.roguelike #root {
    position: relative;
    background-color: var(--crt-bg);
}

/* ============================================
   CRT Effect - Applied ONLY to specific areas
   ============================================ */

/* CRT effect mixin - applied via .crt-screen class */
body.roguelike .crt-screen {
    position: relative;
    isolation: isolate;
    animation: crt-flicker 8s infinite;
}

/* Barrel distortion inspired by Retromator */
body.roguelike [data-crt-barrel="true"] {
    filter: url(#crt-barrel-strong) blur(var(--crt-soft-blur));
    transform: translateZ(0);
}

/* CRT power transition surface */
body.roguelike .crt-power-surface {
    transform-origin: center;
    will-change: transform, filter, opacity;
}

body.roguelike .crt-turn-on {
    animation: crt-turn-on 520ms ease-out both;
}

body.roguelike .crt-turn-off {
    animation: crt-turn-off 420ms cubic-bezier(0.755, 0.05, 0.855, 0.06) both;
}

@keyframes crt-turn-on {
    0% {
        transform: scale(1, 0.8) translate3d(0, 0, 0);
        -webkit-filter: brightness(30);
        filter: brightness(30);
        opacity: 1;
    }
    3.5% {
        transform: scale(1, 0.8) translate3d(0, 100%, 0);
    }
    3.6% {
        transform: scale(1, 0.8) translate3d(0, -100%, 0);
        opacity: 1;
    }
    9% {
        transform: scale(1.3, 0.6) translate3d(0, 100%, 0);
        -webkit-filter: brightness(30);
        filter: brightness(30);
        opacity: 0;
    }
    11% {
        transform: scale(1, 1) translate3d(0, 0, 0);
        -webkit-filter: contrast(0) brightness(0);
        filter: contrast(0) brightness(0);
        opacity: 0;
    }
    100% {
        transform: scale(1, 1) translate3d(0, 0, 0);
        -webkit-filter: contrast(1) brightness(1.2) saturate(1.3);
        filter: contrast(1) brightness(1.2) saturate(1.3);
        opacity: 1;
    }
}

@keyframes crt-turn-off {
    0% {
        transform: scale(1, 1.3) translate3d(0, 0, 0);
        -webkit-filter: brightness(1);
        filter: brightness(1);
        opacity: 1;
    }
    60% {
        transform: scale(1.3, 0.001) translate3d(0, 0, 0);
        -webkit-filter: brightness(10);
        filter: brightness(10);
    }
    100% {
        transform: scale(0.000, 0.0001) translate3d(0, 0, 0);
        -webkit-filter: brightness(50);
        filter: brightness(50);
    }
}

body.roguelike .crt-screen::before,
body.roguelike .crt-screen::after {
    content: "";
    transform: translateZ(0);
    pointer-events: none;
    mix-blend-mode: overlay;
    position: absolute;
    height: 100%;
    width: 100%;
    left: 0;
    top: 0;
    z-index: 10;
    border-radius: inherit;
}

/* Horizontal scanlines */
body.roguelike .crt-screen::before {
    background:
        radial-gradient(
            ellipse at center,
            rgba(255, 255, 255, 0.06) 0%,
            rgba(0, 0, 0, 0.2) 55%,
            rgba(0, 0, 0, 0.7) 100%
        ),
        repeating-linear-gradient(
            0deg,
            transparent 0px,
            rgba(0, 0, 0, 0.35) 1px,
            transparent 2px
        );
    opacity: 0.55;
}

/* RGB pixel effect */
body.roguelike .crt-screen::after {
    background:
        linear-gradient(
            120deg,
            rgba(255, 255, 255, 0.12) 0%,
            rgba(255, 255, 255, 0.04) 35%,
            transparent 60%
        ),
        repeating-linear-gradient(
            90deg,
            var(--crt-red) 0px,
            var(--crt-green) 1px,
            var(--crt-blue) 2px,
            transparent 3px
        );
    opacity: 0.12;
}

/* Panel Styling */
body.roguelike .bg-slate-900,
body.roguelike .bg-slate-800,
body.roguelike .bg-slate-700 {
    background-color: rgba(20, 20, 25, 0.95) !important;
    border: 1px solid var(--crt-green);
    box-shadow:
        0 0 10px rgba(112, 159, 115, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.5);
}

body.roguelike .bg-slate-800\/95 {
    background-color: rgba(20, 20, 25, 0.95) !important;
}

/* Buttons */
body.roguelike button {
    font-family: "Monogram", "DungeonMode", "Courier New", monospace;
    background-color: rgba(30, 30, 35, 0.9) !important;
    border: 1px solid var(--crt-green) !important;
    color: var(--crt-green) !important;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.1s ease;
}

body.roguelike button:hover {
    background-color: var(--crt-green) !important;
    color: var(--crt-bg) !important;
    box-shadow: 0 0 15px var(--crt-green);
}

body.roguelike button:disabled {
    opacity: 0.3;
    border-color: var(--crt-text-dim) !important;
    color: var(--crt-text-dim) !important;
}

/* Primary/Golden buttons */
body.roguelike button.bg-amber-600,
body.roguelike button.bg-amber-500,
body.roguelike .bg-amber-600 {
    border-color: var(--crt-amber) !important;
    color: var(--crt-amber) !important;
}

body.roguelike button.bg-amber-600:hover,
body.roguelike button.bg-amber-500:hover {
    background-color: var(--crt-amber) !important;
    color: var(--crt-bg) !important;
    box-shadow: 0 0 15px var(--crt-amber);
}

/* Danger buttons */
body.roguelike button.bg-red-600,
body.roguelike button.bg-red-500 {
    border-color: var(--crt-red) !important;
    color: var(--crt-red) !important;
}

body.roguelike button.bg-red-600:hover,
body.roguelike button.bg-red-500:hover {
    background-color: var(--crt-red) !important;
    color: var(--crt-bg) !important;
    box-shadow: 0 0 15px var(--crt-red);
}

/* Success buttons */
body.roguelike button.bg-green-600,
body.roguelike button.bg-green-500 {
    border-color: var(--crt-green) !important;
    color: var(--crt-green) !important;
}

/* Inputs */
body.roguelike input,
body.roguelike select,
body.roguelike textarea {
    font-family: "Monogram", "DungeonMode", "Courier New", monospace;
    background-color: rgba(10, 10, 15, 0.9) !important;
    border: 1px solid var(--crt-green) !important;
    color: var(--crt-text) !important;
}

body.roguelike input:focus,
body.roguelike select:focus,
body.roguelike textarea:focus {
    outline: none;
    box-shadow: 0 0 10px var(--crt-green);
}

/* Headers and Text */
body.roguelike h1,
body.roguelike h2,
body.roguelike h3,
body.roguelike h4 {
    font-family: "DungeonMode", "Courier New", monospace;
    color: var(--crt-amber);
    text-transform: uppercase;
    letter-spacing: 2px;
}

body.roguelike .text-amber-400,
body.roguelike .text-amber-500,
body.roguelike .text-yellow-400,
body.roguelike .text-yellow-500 {
    color: var(--crt-amber) !important;
}

body.roguelike .text-green-400,
body.roguelike .text-green-500,
body.roguelike .text-emerald-400 {
    color: var(--crt-green) !important;
}

body.roguelike .text-red-400,
body.roguelike .text-red-500 {
    color: var(--crt-red) !important;
}

body.roguelike .text-blue-400,
body.roguelike .text-blue-500,
body.roguelike .text-cyan-400 {
    color: var(--crt-cyan) !important;
}

body.roguelike .text-purple-400,
body.roguelike .text-purple-500 {
    color: var(--crt-magenta) !important;
}

/* Dungeon Grid */
body.roguelike .dungeon-grid {
    border: 2px solid var(--crt-green);
    box-shadow:
        0 0 20px rgba(112, 159, 115, 0.4),
        inset 0 0 30px rgba(0, 0, 0, 0.6);
}

body.roguelike .dungeon-cell {
    border-color: rgba(112, 159, 115, 0.2) !important;
}

body.roguelike .dungeon-cell.room {
    background-color: rgba(112, 159, 115, 0.15) !important;
    box-shadow: inset 0 0 5px var(--crt-green);
}

body.roguelike .dungeon-cell.corridor {
    background-color: rgba(112, 159, 115, 0.08) !important;
}

body.roguelike .dungeon-cell.door {
    background-color: var(--crt-amber) !important;
    box-shadow: 0 0 8px var(--crt-amber);
}

/* Character/Hero Cards */
body.roguelike .hero-card,
body.roguelike [class*="border-l-"] {
    border-left-color: var(--crt-green) !important;
    background-color: rgba(20, 20, 25, 0.9) !important;
}

/* HP Bars */
body.roguelike .hp-bar {
    background-color: rgba(10, 10, 15, 0.8);
    border: 1px solid var(--crt-green);
}

body.roguelike .hp-bar-fill {
    background: linear-gradient(90deg, var(--crt-green), var(--crt-cyan));
    box-shadow: 0 0 10px var(--crt-green);
}

body.roguelike .hp-bar-fill.low {
    background: linear-gradient(90deg, var(--crt-red), var(--crt-amber));
    box-shadow: 0 0 10px var(--crt-red);
}

/* Modals */
body.roguelike .modal-overlay {
    background-color: rgba(0, 0, 0, 0.85);
}

body.roguelike .modal-content {
    background-color: rgba(20, 20, 25, 0.98) !important;
    border: 2px solid var(--crt-green);
    box-shadow:
        0 0 30px var(--crt-green),
        inset 0 0 50px rgba(0, 0, 0, 0.5);
}

/* Tabs */
body.roguelike .tab-button {
    border-bottom: 2px solid transparent;
}

body.roguelike .tab-button.active {
    border-bottom-color: var(--crt-green);
    color: var(--crt-green);
}

/* Scrollbars */
body.roguelike ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

body.roguelike ::-webkit-scrollbar-track {
    background: var(--crt-bg);
    border: 1px solid var(--crt-green);
}

body.roguelike ::-webkit-scrollbar-thumb {
    background: var(--crt-green);
    box-shadow: 0 0 5px var(--crt-green);
}

body.roguelike ::-webkit-scrollbar-thumb:hover {
    background: var(--crt-cyan);
}

/* Dice Results */
body.roguelike .dice-result {
    color: var(--crt-cyan);
    font-size: 1.5em;
}

/* Log entries */
body.roguelike .log-entry {
    border-left: 2px solid var(--crt-green);
    padding-left: 8px;
    margin-bottom: 4px;
}

body.roguelike .log-entry.combat {
    border-left-color: var(--crt-red);
}

body.roguelike .log-entry.treasure {
    border-left-color: var(--crt-amber);
}

body.roguelike .log-entry.exploration {
    border-left-color: var(--crt-cyan);
}

/* Log timestamp and type tag: use Monogram and be smaller for compact display */
body.roguelike [data-component="log"] .log-entry > span.text-slate-500,
body.roguelike [data-component="log"] .log-entry > span.text-xs,
body.roguelike [data-component="log"] .log-entry > span.inline-block {
    font-family: "Monogram", "DungeonMode", "Courier New", monospace;
    font-size: 1.5rem;
    line-height: 1rem;
}

/* Make the type tag slightly bolder so it stands out */
body.roguelike [data-component="log"] .log-entry > span.inline-block {
    font-weight: 600;
}

/* Be more specific for the timestamp span (first child) */
body.roguelike [data-component="log"] .log-entry > span:first-child {
    color: var(--crt-amber);
    opacity: 0.95;
    margin-right: 0.5rem;
}

/* Keep tag paddings but ensure the Monogram font scales nicely */
body.roguelike [data-component="log"] .log-entry > span.inline-block {
    padding-top: 0.15rem;
    padding-bottom: 0.15rem;
    padding-left: 0.35rem;
    padding-right: 0.35rem;
}

/* Badges and Pills */
body.roguelike .badge,
body.roguelike [class*="rounded-full"] {
    border: 1px solid currentColor;
}

/* Icons - remove glow effect for clarity */
body.roguelike svg {
    filter: none;
}

/* Flicker animation for that authentic CRT feel */
@keyframes crt-flicker {
    0% {
        opacity: 1;
    }
    3% {
        opacity: 0.95;
    }
    6% {
        opacity: 1;
    }
    7% {
        opacity: 0.9;
    }
    9% {
        opacity: 1;
    }
    30% {
        opacity: 1;
    }
    31% {
        opacity: 0.98;
    }
    33% {
        opacity: 1;
    }
    60% {
        opacity: 1;
    }
    61% {
        opacity: 0.96;
    }
    63% {
        opacity: 1;
    }
    100% {
        opacity: 1;
    }
}

/* Turn off the flicker if user prefers reduced motion */
@media (prefers-reduced-motion: reduce) {
    body.roguelike .crt-screen {
        animation: none;
    }
    body.roguelike .crt-screen::after {
        display: none;
    }
    body.roguelike .crt-power-surface,
    body.roguelike .crt-turn-on,
    body.roguelike .crt-turn-off {
        animation: none !important;
    }
}

/* Selection styling */
body.roguelike ::selection {
    background-color: var(--crt-green);
    color: var(--crt-bg);
}

/* Horizontal rules */
body.roguelike hr {
    border: none;
    height: 1px;
    background: linear-gradient(
        90deg,
        transparent,
        var(--crt-green),
        transparent
    );
    box-shadow: 0 0 5px var(--crt-green);
}

/* Tables */
body.roguelike table {
    border: 1px solid var(--crt-green);
}

body.roguelike th {
    background-color: rgba(112, 159, 115, 0.2);
    color: var(--crt-amber);
    border-bottom: 1px solid var(--crt-green);
}

body.roguelike td {
    border-bottom: 1px solid rgba(112, 159, 115, 0.3);
}

body.roguelike tr:hover td {
    background-color: rgba(112, 159, 115, 0.1);
}

/* Tooltips */
body.roguelike [data-tooltip]::after {
    background-color: rgba(20, 20, 25, 0.95);
    border: 1px solid var(--crt-green);
    box-shadow: 0 0 10px var(--crt-green);
}

/* Progress bars */
body.roguelike progress {
    background-color: rgba(10, 10, 15, 0.8);
    border: 1px solid var(--crt-green);
}

body.roguelike progress::-webkit-progress-bar {
    background-color: rgba(10, 10, 15, 0.8);
}

body.roguelike progress::-webkit-progress-value {
    background: var(--crt-green);
    box-shadow: 0 0 5px var(--crt-green);
}

/* ASCII-style decorative elements */
body.roguelike .ascii-border {
    border-style: double;
    border-color: var(--crt-green);
}

/* Monster stat blocks */
body.roguelike .monster-card {
    border: 1px solid var(--crt-red);
    background-color: rgba(218, 49, 49, 0.1);
}

/* Treasure highlights */
body.roguelike .treasure-highlight {
    color: var(--crt-amber);
}

/* Combat damage numbers */
body.roguelike .damage-number {
    color: var(--crt-red);
    font-weight: bold;
}

body.roguelike .heal-number {
    color: var(--crt-green);
    font-weight: bold;
}

/* ============================================
   Dungeon Grid - Roguelike Font Markers
   ============================================ */

/* Dungeon markers using DungeonMode font */
body.roguelike .dungeon-marker {
    font-family: "DungeonMode", "Courier New", monospace;
    font-size: 14px;
    line-height: 1;
    text-shadow: 0 0 4px currentColor;
}

/* Expanded dungeon view when sidebar is collapsed */
body.roguelike [data-dungeon-grid="true"][data-expanded="true"] {
    min-height: 600px;
    display: flex;
    align-items: center;
    justify-content: center;
}

body.roguelike [data-dungeon-grid="true"][data-expanded="true"] .dungeon-cell {
    width: 28px !important;
    height: 28px !important;
}

body.roguelike
    [data-dungeon-grid="true"][data-expanded="true"]
    .dungeon-marker {
    font-size: 16px;
}

/* Rotated dungeon grid styling */
body.roguelike .dungeon-rotated {
    transition: transform 0.3s ease;
}

/* Default (non-roguelike) dungeon marker styles */
.dungeon-marker {
    font-family: "DungeonMode", "Courier New", monospace;
}

/* Marching order styling for roguelike theme */
body.roguelike .marching-order-class {
    font-family: "DungeonMode", "Courier New", monospace;
    font-size: 10px;
    letter-spacing: 0.5px;
}

/* Expanded dungeon view for default theme */
[data-dungeon-grid="true"][data-expanded="true"] {
    min-height: 600px;
    display: flex;
    align-items: center;
    justify-content: center;
}

[data-dungeon-grid="true"][data-expanded="true"] .dungeon-cell {
    width: 28px !important;
    height: 28px !important;
}

[data-dungeon-grid="true"][data-expanded="true"] .dungeon-marker {
    font-size: 14px;
}

/* Rotated grid transition */
.dungeon-rotated {
    transition: transform 0.3s ease;
}
